---
layout: post  
title:  "å­¦ä¹ ç¬”è®°| æ“ä½œç³»ç»ŸåŠèµ„æºç®¡ç†"  
date: 2022-04-06  
description: "linuxç³»ç»Ÿèµ„æºç®¡ç†"
tag: Linux ç³»ç»Ÿç®¡ç†
---


## ğŸ“‘ ç›®å½•

* [ç½‘ç»œç›¸å…³](#network)
* [å¼€å‘è€…å·¥å…·](#developers)
* [æ–‡æœ¬å¤„ç†](#files)
* [å…¶ä»–](#others)

<a id="network"></a>

## ç½‘ç»œ

### ncï¼ˆlinuxä¸‹çš„ç‘å£«å†›åˆ€ï¼‰
[éncæ–¹å¼ç«¯å£æ‰«æè„šæœ¬](https://github.com/huihut/interview/tree/master/DataStructure/SqStack.cpp)

```shell
nc æ˜¯Linuxä¸‹å¼ºå¤§çš„ç½‘ç»œå‘½ä»¤è¡Œå·¥å…· ï¼Œä¸»è¦ç”¨äº TCPã€UDPã€UNIXåŸŸå¥—æ¥å­— ç›¸å…³çš„æ“ä½œ
å®ƒè¢«è®¾è®¡æˆå¯ä»¥ç”±å…¶ä»–ç¨‹åºçµæ´»é©±åŠ¨å¯é çš„åå°å·¥å…·ï¼Œæ‹¥æœ‰ "ç‘å£«å†›åˆ€" çš„ç¾ç§°ï¼Œæ¯ä¸ªç³»ç»Ÿç®¡ç†å‘˜éƒ½åº”è¯¥æŒæ¡å®ƒ

èŠå¤©æœåŠ¡å™¨ï¼š
	nc -l -p 8000
	nc 192.168.56.101 8000
ä¼ è¾“æ–‡ä»¶:
	nc -l -p 1221 > file.tar.gz
	nc ip 1221 < file.tar.gz

ç«¯å£æ‰«æï¼š
	nc -z -v -n -t 192.168.2.23 1-65535
	å‚æ•°è¯¦ç»†ï¼š
		-z è¡¨ç¤ºè¿æ¥ç«‹å³å…³é—­ï¼Œä¸è¿›è¡Œæ•°æ®äº¤æ¢ã€‚

		-v è¡¨ç¤ºè¾“å‡ºæ£€æµ‹ç»“æœï¼Œ-vvè¡¨ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯

		-w è¡¨ç¤ºæ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœä¸æŒ‡å®šå°±æ˜¯tcpè¶…æ—¶çš„æ—¶é—´

		-n è¡¨ç¤ºä¸åå‘è§£æIPåœ°å€çš„åŸŸå

		-t è¡¨ç¤ºTCPæ£€æµ‹ï¼Œé»˜è®¤å°±æ˜¯TCPæ£€æµ‹ï¼›å¦‚æœéœ€è¦æ£€æµ‹UDPï¼Œéœ€è¦åˆ¶å®š-uçš„å‚æ•°


åˆ›å»ºåé—¨ï¼š
	nc -l -p 7788 -e /bin/bash
	å‚æ•°è¯¦ç»†ï¼š
		-e é€‰é¡¹é»˜è®¤ä½¿ç”¨çš„æ˜¯ /bin/bash æ‰§è¡Œå‘½ä»¤, è¿™-eä¹Ÿå¯ä»¥æ¢æˆ -c ,å”¯ä¸€åŒºåˆ«æ˜¯ -c é»˜è®¤ä½¿ç”¨çš„æ˜¯ /bin/sh
		--sh-exec è¿œç¨‹æ‰§è¡Œshellè„šæœ¬
		--lua-exec è¿œç¨‹æ‰§è¡Œluaè„šæœ¬


webæœåŠ¡å™¨ï¼š
	nc -k -l 192.168.70.63 8080 < index.html
	å‚æ•°è¯´æ˜ï¼š
		-k é€‰é¡¹æ˜¯æŒ‡ç›‘å¬æ¨¡å¼æ¥å—å¤šä¸ªè¿æ¥
		
ä½œä¸ºæµè§ˆå™¨
	nc www.baidu.com 80
	è¾“å…¥ï¼šGET / HTTP/1.0

è®¿é—®æ§åˆ¶
	nc -k -l 8000 --lua-exec t.lua  --denyfile deny.txt
	å‚æ•°è¯´æ˜ï¼š
		--allow å…è®¸æŸä¸ªç½‘æ®µipè®¿é—®æ¯”å¦‚ï¼š192.168.62-64
		--deny æ‹’ç»æŸä¸ªç½‘æ®µipè®¿é—®æ¯”å¦‚ï¼š192.168.62-64
		--denyfile é»‘åå•ipæ–‡ä»¶
```

### iperf3(ç½‘ç»œå¸¦å®½æµ‹è¯•)

```shell
Iperfå¯ä»¥æµ‹è¯•æœ€å¤§TCPå’ŒUDPå¸¦å®½æ€§èƒ½ï¼Œå…·æœ‰å¤šç§å‚æ•°å’ŒUDPç‰¹æ€§ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ï¼Œ
å¯ä»¥æŠ¥å‘Šå¸¦å®½ã€å»¶è¿ŸæŠ–åŠ¨å’Œæ•°æ®åŒ…ä¸¢å¤±ã€‚æ”¯æŒwindowsã€androidã€iponeã€macã€ubuntuã€centosç­‰å¤šä¸ªç³»ç»Ÿã€‚
å®˜æ–¹ä¸‹è½½é“¾æ¥ï¼šhttps://iperf.fr/iperf-download.php

æœåŠ¡ç«¯ï¼š
    iperf3 -p 8000 -s -i 1
å‚æ•°è¯´æ˜ï¼š 
	-p : ç«¯å£å· 
	-s : æ ‡ç¤ºæœåŠ¡ç«¯  
	-i : è¡¨ç¤ºæ¯æ¬¡æŠ¥å‘Šçš„é—´éš”s
	
å®¢æˆ·ç«¯ï¼š	
    iperf3 -u -c 192.168.56.101 -p 8000 -i 1 -b 10M
å‚æ•°è¯´æ˜ï¼š 
	-c : æœåŠ¡ç«¯çš„ipåœ°å€ 
	-p : ç«¯å£å· 
	-u : æ ‡ç¤ºudpåè®® 
	-b : è¡¨ç¤ºä½¿ç”¨çš„æµ‹è¯•å¸¦å®½ 
	-t : è¡¨ç¤ºä»¥æ—¶é—´ä¸ºæµ‹è¯•ç»“æŸæ¡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œé»˜è®¤ä¸º 10 ç§’
	-i : è¡¨ç¤ºæ¯æ¬¡æŠ¥å‘Šçš„é—´éš”s 
	-P : è¡¨ç¤ºçº¿ç¨‹ä¸ªæ•°ï¼Œæµ‹è¯•æ•°æ®æµå¹¶å‘æ•°é‡ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤å•çº¿ç¨‹ï¼Œ
	-f ï¼šæ ¼å¼åŒ–å¸¦å®½æ•°è¾“å‡º
	-4 ï¼šæŒ‡å®šipv4
	-B ï¼šç»‘å®šå®¢æˆ·ç«¯çš„ipåœ°å€
	-n ï¼šæŒ‡å®šä¼ è¾“çš„å­—èŠ‚æ•°
	-l ï¼šç”¨äºè®¾ç½®åŒ…çš„å¤§å°
	â€“-g ï¼šè·å–æ¥è‡ªæœåŠ¡å™¨ç«¯çš„ç»“æœ


udpæµ‹è¯•ï¼š
    ./iperf3 -c IP -u -b 100M -f M -i 1 -t 10  --g
 
    ./iperf3 -c IP -u -b 100M -f M -i 1 -t 60 -l 100000 --g 


æŠ¥å‘Šè¯´æ˜ï¼š
	interval ï¼šæ‰“å°å®šæœŸæŠ¥å‘Šçš„é—´éš”æ—¶é—´
	transfer ï¼šå‘é€æ•°æ®é‡
	bandwidth ï¼šå¸¦å®½é€Ÿç‡
	sender ï¼šæ ‡è¯†æ¥æ”¶æˆ–å‘é€ç«¯
	Total Datagrams	ï¼šå‘é€çš„æ•°æ®åŒ…æ•°é‡
	Jitter ï¼šå»¶è¿Ÿ
	Datagrams ï¼šå‘é€åŒ…æ•°é‡
	Lost/Total ï¼šä¸¢åŒ…æ¯”ï¼ˆç‡ï¼‰
```
### tcpdump(ç½‘ç»œæŠ“åŒ…)

```shell
tcpdump -i eno1 udp port 1234 -XXnnvv

tcpdump -i eno1 src 127.0.0.1 -w lis.pcap

tcpdump -r lis.pcap -XXnnvv -A

```
### netstat(ç½‘ç»œçŠ¶æ€ç»Ÿè®¡)
```
netstat -anp|grep 22022
netstat -su
netstat -r
```
### è¿ç»­pingè„šæœ¬

#### [linuxå¹³å°ä¸‹pingè„šæœ¬]()

```shell
#!/bin/bash

COUNT=100
# Get arguments
function usage() {
	echo "Usage: $0 {ip} [count]"
}

[ $# -lt 1 ] && {
	usage
	exit 0
}

if [ $# -eq 2 ];then
	COUNT=$2
fi
ip=$1

echo "ping start ,the count is :${COUNT}" > ./ping_fail.log

count=0;
while [ true ]
do
	ping=`ping -c 1 $ip|grep loss|awk '{split($0, arr, ",");for (i in arr) {print arr[i]}}'|grep loss|awk -F "%" '{print $1}'`
	if [ $ping -eq 100 ];then
		let count+=1 
		echo "ping $ip loss!"
		echo `date +"%Y-%m-%d %H:%M:%S"` >> ./ping_fail.log
		echo  "ping $ip loss" >> ./ping_fail.log
		if [ $count -eq $COUNT ];then
			exit 0
		fi
		#usleep 10000
	else
		#echo $i >>ping_ok.lst
		echo "ping $ip ok!"
		sleep 1
	fi

done
```
#### [windowså¹³å°ä¸‹]()

```shell
@setlocal enableextensions enabledelayedexpansion

@echo off
set COUNT=1000
set i=1
set ipaddr=%1
set oldstate=neither
set filename=%date:~0,10%.log
set filename=ping-%filename:/=-%
echo %filename%

echo "the ping starting" > ./%filename%
:loop
set state=down
for /f "tokens=9 delims= " %%a in ('ping -n 1 !ipaddr! ^| find "%%"') do (
    if "x%%a"=="x(0%%" set state=up
)
::echo.state is !state!

if not !state!==!oldstate! (
	echo !date!-!time! ping !ipaddr! link !oldstate! to !state!
	set /a i+=1
	echo %time% >> ./%filename%
    echo "ping !ipaddr! Link is !state!" >> ./%filename%
    set oldstate=!state!
	if !i! geq !COUNT! (exit 0)
)
ping -n 2 127.0.0.1 >nul: 2>nul:
goto :loop



endlocal
```

<a id="developers"></a>

## å¼€å‘è€…å·¥å…·

### straceï¼ˆæŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨ï¼‰

```shell
strace -tt -T -v -f -e trace=file -o ./strace.log -s 1024 -p pid

strace -c -p 11084

strace å‚æ•°è¯´æ˜
-c    ç»Ÿè®¡æ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ‰€æ‰§è¡Œçš„æ—¶é—´ã€æ¬¡æ•°å’Œå‡ºé”™çš„æ¬¡æ•°ç­‰
-d    è¾“å‡ºstraceå…³äºæ ‡å‡†é”™è¯¯çš„è°ƒè¯•ä¿¡æ¯
-f    è·Ÿè¸ªç›®æ ‡è¿›ç¨‹ï¼Œä»¥åŠç›®æ ‡è¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰å­è¿›ç¨‹
-ff   å¦‚æœæä¾›-o filenameï¼Œåˆ™å°†æ‰€æœ‰è¿›ç¨‹çš„è·Ÿè¸ªç»“æœè¾“å‡ºåˆ°ç›¸åº”çš„filename.pidä¸­ï¼Œpidæ˜¯å„è¿›ç¨‹çš„è¿›ç¨‹å·
-i    è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„å…¥å£æŒ‡é’ˆ
-q    ç¦æ­¢è¾“å‡ºå…³äºè„±ç¦»çš„æ¶ˆæ¯
-r    è¾“å‡ºæ¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„ç›¸å¯¹æ—¶é—´
-t    åœ¨è¾“å‡ºä¸­çš„æ¯ä¸€è¡Œå‰åŠ ä¸Šæ—¶é—´ä¿¡æ¯ã€‚ä¾‹å¦‚16ï¼š45ï¼š28
-tt   åœ¨è¾“å‡ºä¸­çš„æ¯ä¸€è¡Œå‰åŠ ä¸Šæ—¶é—´ä¿¡æ¯ï¼Œç²¾ç¡®åˆ°å¾®ç§’ã€‚ä¾‹å¦‚11ï¼š18ï¼š59.759546ç«¯
-ttt  åœ¨è¾“å‡ºä¸­çš„æ¯ä¸€è¡Œå‰åŠ ä¸Šæ—¶é—´ä¿¡æ¯ï¼Œç²¾ç¡®åˆ°å¾®ç§’ï¼Œè€Œä¸”æ—¶é—´è¡¨ç¤ºä¸ºUNIXæ—¶é—´æˆ³ã€‚ä¾‹å¦‚1486111461.650434
-T    æ˜¾ç¤ºæ¯æ¬¡ç³»ç»Ÿè°ƒç”¨æ‰€èŠ±è´¹çš„æ—¶é—´
-v    å¯¹äºæŸäº›ç›¸å…³è°ƒç”¨ï¼ŒæŠŠå®Œæ•´çš„ç¯å¢ƒå˜é‡ã€æ–‡ä»¶statç»“æ„ç­‰æ‰“å°å‡ºæ¥
-x    ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºéæ ‡å‡†å­—ç¬¦ç‡
-xx   æ‰€æœ‰å­—ç¬¦ä¸²ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡º

-e expr è¾“å‡ºè¿‡æ»¤å™¨ï¼Œé€šè¿‡è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿‡æ»¤æ‰ä½ ä¸æƒ³è¦çš„è¾“å‡º
        expræ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨äºæ§åˆ¶å¦‚ä½•è·Ÿè¸ªï¼š[qualifier=][!][valuel[,value2]..
        è¯´æ˜ï¼š
        â‘ qualifier åªèƒ½æ˜¯traceã€abbrevã€verboseã€rawã€signalã€readã€writeå…¶ä¸­ä¹‹ä¸€
        â‘¡valueæ˜¯ç”¨æ¥é™å®šçš„ç¬¦å·æˆ–æ•°å­—
        â‘¢é»˜è®¤çš„qualifieræ˜¯trace
        â‘£æ„Ÿå¹å·æ˜¯å¦å®šç¬¦å·
        ä¾‹å¦‚ï¼š
        -e openç­‰ä»·äº-e trace=openï¼Œè¡¨ç¤ºåªè·Ÿè¸ªopenè°ƒç”¨
        è€Œ-e trace!=openè¡¨ç¤ºè·Ÿè¸ªé™¤äº†openä»¥å¤–çš„å…¶ä»–è°ƒç”¨
        å¸¸è§é€‰é¡¹ï¼š
        -e trace=[set]    åªè·Ÿè¸ªæŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨
        -e trace=file     åªè·Ÿè¸ªä¸æ–‡ä»¶æ“ä½œæœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e trace=process  åªè·Ÿè¸ªä¸è¿›ç¨‹æ§åˆ¶æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e trace-network  åªè·Ÿè¸ªä¸ç½‘ç»œæœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e trace=signal   åªè·Ÿè¸ªä¸ç³»ç»Ÿä¿¡å·æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e trace=desc     åªè·Ÿè¸ªä¸æ–‡ä»¶æè¿°ç¬¦æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e trace=ipc      åªè·Ÿè¸ªä¸è¿›ç¨‹é€šä¿¡æœ‰å…³çš„ç³»ç»Ÿè°ƒç”¨
        -e abbrev=[set]   è®¾å®šstraceè¾“å‡ºçš„ç³»ç»Ÿè°ƒç”¨çš„ç»“æœé›†
        -e raw=[set]      å°†æŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä»¥åå…­è¿›åˆ¶æ˜¾ç¤º
        -e signal=[set]   æŒ‡å®šè·Ÿè¸ªçš„ç³»ç»Ÿä¿¡å·
        -e read=[set]     è¾“å‡ºä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å‡ºçš„æ•°æ®
        -e write=[set]    è¾“å‡ºå†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­çš„æ•°æ®
 
-o filename    å°†straceçš„è¾“å‡ºå†™å…¥æ–‡ä»¶filename
-p pid         æŒ‡å®šè¦è·Ÿè¸ªçš„è¿›ç¨‹pidï¼Œè¦åŒæ—¶è·Ÿè¸ªå¤šä¸ªpidï¼Œé‡å¤å¤šæ¬¡pé€‰é¡¹å³å¯*
-s strsize     æŒ‡å®šè¾“å‡ºçš„å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤ä¸º32ã€‚å¹¶æ²¡æœ‰å°†æ–‡ä»¶åè§†ä¸ºå­—ç¬¦ä¸²ï¼Œé»˜è®¤å…¨éƒ¨è¾“å‡º
-u username    ä»¥usemameçš„UIDå’ŒGIDæ‰§è¡Œæ‰€è·Ÿè¸ªçš„å‘½ä»¤
```

### pstackï¼ˆæŸ¥çœ‹è¿›ç¨‹å †æ ˆä¿¡æ¯ï¼‰

```shell
pstack pid

```
### valgrindï¼ˆè¿›ç¨‹å†…å­˜æ£€æŸ¥å·¥å…·ï¼‰

```shell
valgrind -v --tool=memcheck --leak-check=full --show-reachable=yes --track-origins=yes --log-file=./logs/valgrind.log \
            ./bin/gws
```

### perf (æ€§èƒ½ä¼˜åŒ–å·¥å…·ç«ç„°å›¾)

```shell
å®æ—¶ç»Ÿè®¡ï¼š
	perf top -p pid
é‡‡æ ·ï¼š
	perf record -a -g -p pid -- sleep 60
æŠ¥å‘Šåˆ†æï¼š
	perf report ./perf.data -n --stdio
ç”Ÿäº§svgç«ç„°å›¾ï¼š
	cd FlameGraph-master/    [éœ€è¦ä¸‹è½½](https://github.com/brendangregg/FlameGraph/tags)
	perf script -i ../perf.data | ./stackcollapse-perf.pl --all | ./flamegraph.pl > test.svg	
æµè§ˆæŸ¥çœ‹ç«ç„°å›¾ï¼š
	y è½´è¡¨ç¤ºè°ƒç”¨æ ˆï¼Œæ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è°ƒç”¨æ ˆè¶Šæ·±ï¼Œç«ç„°å°±è¶Šé«˜ï¼Œé¡¶éƒ¨å°±æ˜¯æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸‹æ–¹éƒ½æ˜¯å®ƒçš„çˆ¶å‡½æ•°ã€‚
	x è½´è¡¨ç¤ºæŠ½æ ·æ•°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°åœ¨xè½´å æ®çš„å®½åº¦è¶Šå®½ï¼Œå°±è¡¨ç¤ºå®ƒè¢«æŠ½åˆ°çš„æ¬¡æ•°å¤šï¼Œå³æ‰§è¡Œçš„æ—¶é—´é•¿ã€‚æ³¨æ„ï¼Œx è½´ä¸ä»£è¡¨æ—¶é—´ï¼Œ
	è€Œæ˜¯æ‰€æœ‰çš„è°ƒç”¨æ ˆåˆå¹¶åï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„ã€‚
	ä»é¡¶å±‚æŸ¥çœ‹å‡½æ•°å xè½´å®½åº¦ï¼Œå®½åº¦è¶Šå®½è¶Šå¯èƒ½éœ€è¦ä¼˜åŒ–
```

<a id="files"></a>

## æ–‡æœ¬å¤„ç†

### lsof(åˆ—å‡ºæ‰“å¼€æ–‡ä»¶ä¿¡æ¯)

```shell
lsofæ˜¯ç³»ç»Ÿç®¡ç†/å®‰å…¨çš„å°¤ä¼¯å·¥å…·ã€‚å°†è¿™ä¸ªå·¥å…·ç§°ä¹‹ä¸ºlsofçœŸå®åå‰¯å…¶å®ï¼Œå› ä¸ºå®ƒæ˜¯
æŒ‡â€œåˆ—å‡ºæ‰“å¼€æ–‡ä»¶ï¼ˆlists openfilesï¼‰â€ã€‚è€Œæœ‰ä¸€ç‚¹è¦åˆ‡è®°ï¼Œåœ¨Unixä¸­ä¸€åˆ‡ï¼ˆåŒ…æ‹¬ç½‘ç»œå¥—æ¥å£ï¼‰éƒ½æ˜¯æ–‡ä»¶ã€‚

å‚æ•°è¯´ï¼š
	é»˜è®¤ : æ²¡æœ‰é€‰é¡¹ï¼Œlsofåˆ—å‡ºæ´»è·ƒè¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€æ–‡ä»¶
	ç»„åˆ : å¯ä»¥å°†é€‰é¡¹ç»„åˆåˆ°ä¸€èµ·ï¼Œå¦‚-abcï¼Œä½†è¦å½“å¿ƒå“ªäº›é€‰é¡¹éœ€è¦å‚æ•°
	-a : ç»“æœè¿›è¡Œâ€œä¸â€è¿ç®—ï¼ˆè€Œä¸æ˜¯â€œæˆ–â€ï¼‰
	-l : åœ¨è¾“å‡ºæ˜¾ç¤ºç”¨æˆ·IDè€Œä¸æ˜¯ç”¨æˆ·å
	-h : è·å¾—å¸®åŠ©
	-t : ä»…è·å–è¿›ç¨‹ID
	-U : è·å–UNIXå¥—æ¥å£åœ°å€
	-F : æ ¼å¼åŒ–è¾“å‡ºç»“æœï¼Œç”¨äºå…¶å®ƒå‘½ä»¤ã€‚å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ ¼å¼åŒ–ï¼Œå¦‚-F pcfnï¼ˆç”¨äºè¿›ç¨‹idã€å‘½ä»¤åã€æ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶åï¼Œå¹¶ä»¥ç©ºç»ˆæ­¢ï¼‰

ä½¿ç”¨-iæ˜¾ç¤ºæ‰€æœ‰è¿æ¥
	 lsof -i[46] [protocol][@hostname|hostaddr][:service|port]
	 lsof -i4 tcp :22
	 lsof -i4 @192.168.56.101
	 lsof -i @192.168.56.101:80
	 
ä½¿ç”¨-uæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·æ‰“å¼€é‚£äº›æ–‡ä»¶
	lsof  -u panda 
	lsof  -u ^panda
	kill  -9  `lsof -t -u daniel`
	
ä½¿ç”¨-cæ˜¾ç¤ºæŸä¸ªè¿›ç¨‹ä½¿ç”¨äº†é‚£äº›æ–‡ä»¶åŠç½‘ç»œ
	lsof -c ssh
	lsof -p pid
```

#### lsofå¸¸ç”¨ä¸¾ä¾‹

* lsof abc.txt æ˜¾ç¤ºå¼€å¯æ–‡ä»¶abc.txtçš„è¿›ç¨‹
* lsof -i :22 çŸ¥é“22ç«¯å£ç°åœ¨è¿è¡Œä»€ä¹ˆç¨‹åº
* lsof -c abc æ˜¾ç¤ºabcè¿›ç¨‹ç°åœ¨æ‰“å¼€çš„æ–‡ä»¶
* lsof -g gid æ˜¾ç¤ºå½’å±gidçš„è¿›ç¨‹æƒ…å†µ
* lsof +d /usr/local/ æ˜¾ç¤ºç›®å½•ä¸‹è¢«è¿›ç¨‹å¼€å¯çš„æ–‡ä»¶
* lsof +D /usr/local/ åŒä¸Šï¼Œä½†æ˜¯ä¼šæœç´¢ç›®å½•ä¸‹çš„ç›®å½•ï¼Œæ—¶é—´è¾ƒé•¿
* lsof -d 4 æ˜¾ç¤ºä½¿ç”¨fdä¸º4çš„è¿›ç¨‹ www.2cto.com
* lsof -i ç”¨ä»¥æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹æƒ…å†µ

### grep\sed\awkï¼ˆlinuxæ–‡æœ¬å¤„ç†3å‰‘å®¢ï¼‰

```shell
grep ä¸¾ä¾‹ï¼š

cp /etc/passwd   /mnt
cd /mnt
vim /mnt/passwd
æ·»åŠ ï¼ˆä¸ºåè¾¹çš„å®éªŒæ•ˆæœåšå‡†å¤‡ï¼‰ï¼š
test:test:root
ROOT:test:test
test:root:test
 
grep ^root  passwd    #è¿‡æ»¤ä»¥rootå¼€å¤´çš„è¡Œ
grep root$  passwd    #è¿‡æ»¤ä»¥rootç»“å°¾çš„è¡Œ
grep -i ^root  passwd    #ä¸åŒºåˆ†å¤§å°å†™,è¿‡æ»¤ä»¥rootç»“å°¾çš„è¡Œ
grep -E "^root|root$"  passwd #è¿‡æ»¤ä»¥rootå¼€å¤´æˆ–è€…ä»¥rootç»“å°¾çš„è¡Œï¼Œ-Eè¡¨ç¤ºæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼
grep -E -v "^root|root$"  passwd   #-vè¡¨ç¤ºåå‘è¿‡æ»¤
grep -E -v "^root|root$"  passwd | grep root    #è¿‡æ»¤rootåœ¨ä¸­é—´çš„è¡Œ
grep -i root passwd | grep -v -i -E "^root|root$"  #è¿‡æ»¤rootåœ¨ä¸­é—´çš„è¡Œ
grep 'r.t' test       #è¿‡æ»¤rå’Œtä¹‹é—´åªæœ‰ä¸€ä¸ªå­—ç¬¦
grep 'r..t' test      #è¿‡æ»¤rå’Œtä¹‹é—´æœ‰äºŒä¸ªå­—ç¬¦
grep 'r...t' test     #è¿‡æ»¤rå’Œtä¹‹é—´æœ‰ä¸‰ä¸ªå­—ç¬¦
grep 'r*t' test       #è¿‡æ»¤rå‡ºç°çš„ä»»æ„æ¬¡æ•°
grep  'r\**t' test    #è¿‡æ»¤r,tä¹‹é—´æœ‰0ä¸ªå­—ç¬¦
grep  'ro*t' test     #è¿‡æ»¤rå’Œtä¹‹é—´oå‡ºç°çš„ä»»æ„æ¬¡æ•°
grep  -E 'ro*t' test  #è¿‡æ»¤rå’Œtä¹‹é—´oå‡ºç°çš„ä»»æ„æ¬¡æ•°
grep  -E 'ro?t' test  #è¿‡æ»¤rå’Œtä¹‹é—´oå‡ºç°çš„0å’Œ1æ¬¡
grep  -E 'ro{1,}t' test  #è¿‡æ»¤rå’Œtä¹‹é—´oå‡ºç°çš„1ä»¥ä¸Šçš„æ¬¡æ•°
grep  -E 'ro{,3}t' test  #è¿‡æ»¤rå’Œtä¹‹é—´oå‡ºç°çš„3ä»¥ä¸‹çš„æ¬¡æ•°


sedè¡Œæ“ä½œï¼š

/*æ˜¾ç¤º*/
sed -n '^:/p' fstab   #æ˜¾ç¤ºfstabä¸­ä»¥ï¼šå¼€å¤´çš„è¡Œ
sed -n 'UUID$/p' fstab  #æ˜¾ç¤ºfstabä¸­ä»¥UUIDç»“å°¾çš„è¡Œ
sed -n '/^UUID/p' fstab  #æ˜¾ç¤ºfstabä¸­ä»¥UUIDå¼€å¤´çš„è¡Œ
sed -n '2,6p' fstab    #æ˜¾ç¤ºfstabä¸­çš„ç¬¬äºŒå’Œç¬¬å…­è¡Œ
sed -n '2,6!p' fstab    #æ˜¾ç¤ºfstabä¸­é™¤è¿‡ç¬¬äºŒå’Œç¬¬å…­è¡Œå…¶ä½™çš„è¡Œ
/*åˆ é™¤*/
sed '/^UUID/d'  fstab   #åˆ é™¤ä»¥UUIDå¼€å¤´çš„è¡Œ
sed '/^#/d'   fstab     #åˆ é™¤ä»¥#å¼€å¤´çš„è¡Œ 
sed '/^$/d'   fstab     #åˆ é™¤ä»¥ç©ºæ ¼å¼€å¤´çš„è¡Œ 
sed  '/^UUID/!d'  fstab  #åˆ é™¤ä¸æ˜¯ä»¥UUIDå¼€å¤´çš„è¡Œ
cat -n fstab | sed '1,4d'  #åˆ é™¤1åˆ°4è¡Œ
cat -n fstab | sed -e '2d;6d'   #åˆ é™¤ç¬¬äºŒè¡Œå’Œç¬¬å…­è¡Œ
/*æ·»åŠ */
sed '/^UUID/a\hello'  fstab   #åœ¨ä»¥UUIDå¼€å¤´çš„è¡Œçš„å‰ä¸€è¡Œæ·»åŠ hello
sed '/^UUID/a\hello  \nwestos'  fstab  #åœ¨ä»¥UUIDå¼€å¤´çš„è¡Œçš„å‰ä¸€è¡Œæ·»åŠ helloæ¢è¡Œå†æ·»åŠ westos
 
/*æ’å…¥*/
sed '/^UUID/i\hello'   fstab   #åœ¨UUIDçš„å‰ä¸€è¡Œæ·»åŠ hello
 
/*æ›¿æ¢*/
sed 's/è¦è¢«å–ä»£çš„å­—ä¸²/æ–°çš„å­—ä¸²/g' #æŸ¥æ‰¾å¹¶æ›¿æ¢
sed '/^UUID/c\hello' fstab  #æŠŠä»¥UUIDå¼€å¤´çš„è¡Œæ›¿æ¢æˆhello
 
 
/*å…¶ä»–æ“ä½œ*/
1  sed -n '/^UUID/='  fstab  #æ˜¾ç¤ºä»¥UUIDå¼€å¤´çš„è¡Œå·
2  sed -n -e  '/^UUID/p' -e '/^UUID/=' fstab  #-eç”¨æ¥è¿æ¥''
3  sed '=' fstab | sed 'N'     #Nè¡¨ç¤ºæ¯è¡Œå¤šåŠ ä¸€ä¸ªæ¢è¡Œç¬¦
4  sed '=' fstab | sed 's/\n//g'    #æ˜¾ç¤ºè¡Œå·å¹¶æ¢è¡Œ 
5  sed '=' fstab | sed 'N;s/\n/ /g'  #æ˜¾ç¤ºè¡Œå·ä¸æ¢è¡Œ
6  sed 'G' fstab   #æ¯è¡ŒåŠ ç©ºè¡Œæ˜¾ç¤ºfstabä¸­å†…å®¹ 
7  sed '$!G' fstab     #æ¯è¡ŒåŠ ç©ºè¡Œä½†æœ€åä¸€è¡Œä¸åŠ ç©ºè¡Œæ˜¾ç¤º
8  sed -n '$p'  fstab      #æ˜¾ç¤ºæ–‡ä»¶çš„æœ€åä¸€è¡Œ
9  sed 's/nologin/westos/g' passwd     #æŠŠpasswdä¸­ä»¥nologinç»“å°¾çš„å…¨éƒ¨æ›¿æ¢ä¸ºwestos
10 sed '3,5s/nologin/westos/g' passwd  #ç”¨westosæ›¿æ¢passwdä¸­ç¬¬ä¸‰è¡Œåˆ°ç¬¬äº”è¡Œçš„nologin
11 sed '/adm/,/sync/s/nologin/westos/g;s/sbin/wang/g' passwd  #ç”¨westosæ›¿æ¢ä»¥admå’Œsyncå¼€å¤´


awkåˆ—æ“ä½œï¼š

awk '{print $1}' #æ‰“å°ç¬¬ä¸€åˆ—
awk 'BEGIN{ORS=","}{print $1}' #æ‰“å°ç¬¬ä¸€åˆ—å¹¶æ›¿æ¢æ¢è¡Œä¸ºé€—å·
awk -F ":" '{print $1}' passwd  #ä»¥:ä¸ºåˆ†éš”ç¬¦ï¼Œæ˜¾ç¤ºç¬¬ä¸€åˆ—
awk -F ":" 'BEGIN{print "NAME"}{print $1}'  passwd  #ä»¥NAMEå¼€å§‹æ˜¾ç¤ºç¬¬ä¸€åˆ—
awk -F ":" 'BEGIN{print "NAME"}{print NR$1}END{print "END"}'  passwd #ä»¥NAMEå¼€å§‹ï¼Œä»¥ENDç»“æŸï¼Œæ˜¾ç¤ºç¬¬ä¸€åˆ—å¹¶æ˜¾ç¤ºè¡Œå·
awk -F ":" 'BEGIN{print "NAME"}{print NR;print  }END{print "END"}'  passwd #æ˜¾ç¤ºè¡Œå·å¹¶æ¢è¡Œ
awk -F ":" '/bash$/{print $1}' passwd   #shç»“å°¾çš„è¡Œçš„ç¬¬ä¸€åˆ—,$1è¡¨ç¤ºç¬¬ä¸€åˆ—
awk -F ":" 'BEGIN{N=0}/bash$/{N++}END{print N}'  passwd  #ç»Ÿè®¡passwdä¸­ä»¥bashç»“å°¾çš„è¡Œæ•°
awk '/^ro/{print}' passwd      #æ‰“å°ä»¥roå¼€å¤´çš„è¡Œ
awk '/^[^a-d]/{print}' passwd  #æ‰“å°ä»¥aåˆ°då¼€å¤´çš„è¡Œ
awk '/^a|nologin$/{print}'  passwd  #æ‰“å°ä»¥aå¼€å¤´æˆ–è€…ä»¥nologinç»“å°¾çš„è¡Œ
awk -F ":" '$1~/^r/{print}'  passwd #æ‰“å°ä»¥rå¼€å¤´çš„è¡Œ
awk -F ":" '$1!~/^r/{print}'  passwd  #æ‰“å°ä¸ä»¥rå¼€å¤´çš„è¡Œ
awk -F ":" '{print NR,$0}' passwd  #ä»¥:ä¸ºåˆ†éš”ç¬¦æ‰“å°ç¬¬ä¸€åˆ—ï¼Œå¹¶è¡¨ç¤ºè¡Œå·ï¼Œ$0è¡¨ç¤ºæ–‡ä»¶ä¸€æ•´è¡Œçš„å†…å®¹
```

<a id="others"></a>

## å…¶ä»–

### å‚è€ƒèµ„æ–™æ–‡çŒ®
* [Linux Performance And BPF Tools](https://www.brendangregg.com/index.html)